---
layout: post
title: 文本配置文件的解析(一)
tags: [c,compiler]
---

在实际开发中，配置文件是很多程序都需要提供的一个功能，配置文件一般可采用标准的xml格式，也可以通过config文件格式。最近在配置文件的解析方面，写了一些程序，这里记录文字梳理一下开发心得。配置文件的解析采用了编译原理中的语法分析器的思想来设计，先定义好产生式，通过产生式设计代码。一个普通的配置文件格式如下:

    S -> MS | e  ;;起始符号
	M -> T{ MPM | MP | PM | P } ;; 模块产生式
	P -> K=VP | K=VMP | K=VM | K=V ;; 键值对产生式
	K -> Token ;; 标记词语
	V -> Token
	T -> Token

模块可以不断的嵌套，键值对包含在模块内，对应一个配置文件的具体格式可如下:
    #123456
	module1 { 
	module2 {
	key1 = value1
	module3 {
	key2 = value2
	module4 {
	key3 = value3
	}
	key4 = value4
	} #21432
	key0 = value0 #4324
	key6 = value6 #123
	}
	key5 = value5
	}
	
	module5 {
	key7 = value7
	}

    # adsf

配置文件的解析就无异于一个词法分析器了，通过分析各产生式来判断具体的文件格式。在实际中，感觉最难部分就是在分析产生式中配置文件的解析选择对应的产生式,如M -> T{ MPM | MP | PM | P },到底选择哪一个产生式?这里采用了最简单的自顶向下分析，通过向前查看一个符号来判断下一个即将进入的状态。遇到{就知道进入了M状态，扫描到=进入状态P,扫描}进入状态M,就是这样每次向前查看的方法，遇到#进入注释状态，最后解析整个配置文件.在提前扫描过程中，采用了最简单的单缓冲区模式，提前扫描的字符通过fseek函数重置读取状态。
